(function(){$(document).ready(function(){var d=$(".jsCalendar");for(var c=0,b=d.length;c<b;c++){var e=new a();e.ready(d.eq(c))}});function a(){var l=this,u,h,t,k,f,i,m,c,q,n,v,e,s,j,r="click",o="noAnimationEnd",p=Modernizr.csstransforms3d?"webkit moz o ms khtml ".split(" ").join("AnimationEnd ")+"animationEnd":o,d="startDate",g="endDate";var b=function(w,x){if(w==d){c=x}else{q=x}l.drawSelection();u.data(w.toLowerCase(),!x?"":x.toString());u.trigger(w+"Changed")};l.ready=function(E){u=E;h=$('<a href="#">&lt;</a>');t=$('<a href="#">&gt;</a>');k=$('<li class="calMonth"></li>');u.append($('<ul class="calButtonBar"></ul>').append($('<li class="calPrevious"></li>').append(h)).append(k).append($('<li class="calNext"></li>').append(t)));for(var z=0,x="",y="";z<7;z++){x+="<th></th>";y+='<td><a href="#"></a></td>'}for(var z=0,B="";z<6;z++){B+="<tr>"+y+"</tr>"}u.append('<div class="calGrid"><table><tr>'+x+"</tr>"+B+"</table></div>");f=u.find("th");i=u.find("td a");m=u.find("tr");m.eq(1).addClass("first");j=u.hasClass("jsSingleDate");u.get(0).calendar=l;if($.fn&&!$.fn.slice){$.fn.slice=function(G,F){return $([].slice.call(this,G,F))}}l.extendDate();v=new Date();v=v.clearTime();e=v;c=c;q=q;n=(c||v).clone();s=u.data("localized_date");if(typeof s=="string"){s=JSON.parse(s)}var C=u.find(".calGrid");var A=[];var w=function(F){if(C.children().length>1){A.push(F);return true}return false};var D=function(){if(A.length>0){setTimeout(function(){A.shift().trigger(r)},0)}};h.bind(r,function(F){F.preventDefault();if(w(h)){return}n=n.addMonths(-1);var G=$("<table>"+u.find("table").html()+"</table>");C.append(G);i.closest("table").addClass("turndown").bind(p,function(H){$(this).removeClass("turndown").unbind(p);G.remove();D()}).trigger(o);l.showMonth(n)});t.bind(r,function(F){F.preventDefault();if(w(t)){return}n=n.addMonths(+1);var G=$('<table class="turnup">'+u.find("table").html()+"</table>");C.append(G);G.bind(p,function(H){G.remove();D()}).trigger(o);l.showMonth(n)});i.bind(r,l.dateSelected);u.bind("resetDates",function(F){b(d,null);b(g,null)});l.showMonth(n)};l.dateSelected=function(w){w.preventDefault();var y=$(this);if(y.hasClass("inactive")||(y.text().length==0)){return}var x=new Date(n.getFullYear(),n.getMonth(),parseInt(y.text()));if(j){b(d,!c||(x.getTime()!=c.getTime())?x:null);return}if(!c){if(!q){b(d,x)}else{if(x<q){b(d,x)}else{if(q<x){b(d,q);b(g,x)}else{b(g,null)}}}}else{if(!q){if(c<x){b(g,x)}else{if(x<c){b(g,c);b(d,x)}else{b(d,null)}}}else{if(y.hasClass(d)){b(d,null)}else{if(y.hasClass(g)){b(g,null)}else{b(d,null);b(g,null)}}}}};l.extendDate=function(){Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.isLeapYear=function(){var w=this.getFullYear();return(((w%4===0)&&(w%100!==0))||(w%400===0))};Date.prototype.getDaysInMonth=function(){return[31,(this.isLeapYear(this.getFullYear())?29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype.moveToFirstDayOfMonth=function(){this.setDate(1);return this};Date.prototype.moveToLastDayOfMonth=function(){this.setDate(this.getDaysInMonth());return this};Date.prototype.addMilliseconds=function(w){this.setMilliseconds(this.getMilliseconds()+w);return this};Date.prototype.addDays=function(w){return this.addMilliseconds(w*86400000)};Date.prototype.addMonths=function(w){var x=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+w);this.setDate(Math.min(x,this.getDaysInMonth()));return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this}};l.getDay=function(w){return(w+6)%7};l.drawSelection=function(){i.removeClass(d).removeClass(g).removeClass("betweenDates");var y=n.clone().moveToFirstDayOfMonth();var A=n.clone().moveToLastDayOfMonth();var x=l.getDay(y.getDay())-1;if(!!c&&!!q&&(c<A)&&(q>y)){var w=new Date(Math.max(y,c.clone().addDays(1)));var z=new Date(Math.min(A,q.clone().addDays(-1)));if(w<=z){i.slice(x+w.getDate(),x+z.getDate()+1).addClass("betweenDates")}}if(!!c&&(y<=c)&&(c<=A)){i.eq(x+c.getDate()).addClass(d)}if(!!q&&(y<=q)&&(q<=A)){i.eq(x+q.getDate()).addClass(g)}};l.showMonth=function(x){e=new Date(Math.max(e,v));if(!!s){k.text(s.months.names["long"][x.getMonth()]+" "+x.getFullYear());for(var A=0,E=f.length;A<E;A++){f.eq(l.getDay(A)).text(s.days.names.min[A])}}var F=e>x.clone().moveToLastDayOfMonth();var B=!F&&(e>=x.clone().moveToFirstDayOfMonth());var z=e.getDate();i.addClass("noTransition").removeClass("inactive");m.removeClass("last").removeClass("hidden");for(var w=l.getDay(x.clone().moveToFirstDayOfMonth().getDay())-1,D=w+x.clone().moveToLastDayOfMonth().getDate(),A=0,E=i.length;A<E;A++){var C=(A>w)&&(A<=D);var y=i.eq(A).text(C?(""+(A-w)):"");if(C&&(F||(B&&(A-w<z)))){y.addClass("inactive")}if(B&&v.getDate()==(A-w)){y.addClass("today")}if(A==D){y.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}}setTimeout(function(){i.removeClass("noTransition")},0);l.drawSelection()}}})();