(function(){$(document).ready(function(){var d=$(".jsCalendar");for(var c=0,b=d.length;c<b;c++){var e=new a();e.ready(d.eq(c))}});function a(){var l=this,v,h,u,k,f,i,o,c,r,p,w,e,t,j,m=0,s="click",n="noAnimationEnd",q=Modernizr.csstransforms3d?"webkit moz o ms khtml ".split(" ").join("AnimationEnd ")+"animationEnd":n,d="startDate",g="endDate";var b=function(x,y){y&&y.clearTime&&y.clearTime();if(x==d){c=y}else{r=y}l.drawSelection();v.data(x.toLowerCase(),!y?"":y.toString());v.trigger(x+"Changed")};l.ready=function(F){v=F;h=$('<a href="#">&lt;</a>');u=$('<a href="#">&gt;</a>');k=$('<li class="calMonth"></li>');v.append($('<ul class="calButtonBar"></ul>').append($('<li class="calPrevious"></li>').append(h)).append(k).append($('<li class="calNext"></li>').append(u)));for(var A=0,y="",z="";A<7;A++){y+="<th></th>";z+='<td><a href="#"></a></td>'}for(var A=0,C="";A<6;A++){C+="<tr>"+z+"</tr>"}v.append('<div class="calGrid"><table><tr>'+y+"</tr>"+C+"</table></div>");f=v.find("th");i=v.find("td a");o=v.find("tr");o.eq(1).addClass("first");j=v.hasClass("jsSingleDate");m=v.data("firstdayofweek")||m;v.get(0).calendar=l;if($.fn){$.fn.slice=$.fn.slice||function(H,G){return $([].slice.call(this,H,G))};$.fn.calendar=function(){return this.get(0).calendar}}l.extendDate();w=(new Date()).clearTime();e=w;c=v.data("startdate");c=c?new Date(c).clearTime():null;r=v.data("enddate");r=r?new Date(r).clearTime():null;p=(c||w).clone();t=v.data("localized_date");if(typeof t=="string"){t=JSON.parse(t)}var D=v.find(".calGrid");var B=[];var x=function(G){if(D.children().length>1){B.push(G);return true}return false};var E=function(){if(B.length>0){setTimeout(function(){B.shift().trigger(s)},0)}};h.bind(s,function(G){G.preventDefault();if(x(h)){return}p=p.addMonths(-1);var H=$("<table>"+v.find("table").html()+"</table>");D.append(H);i.closest("table").addClass("turndown").bind(q,function(I){$(this).removeClass("turndown").unbind(q);H.remove();E()}).trigger(n);l.showMonth(p)});u.bind(s,function(G){G.preventDefault();if(x(u)){return}p=p.addMonths(+1);var H=$('<table class="turnup">'+v.find("table").html()+"</table>");D.append(H);H.bind(q,function(I){H.remove();E()}).trigger(n);l.showMonth(p)});v.bind("resetDates",function(G){b(d,null);b(g,null)});i.bind(s,l.dateSelected);l.showMonth(p)};l.setDates=function(y,x){b(d,y&&x?new Date(Math.min(y,x)):y);!j&&b(g,y&&x?(y.getTime()!=x.getTime()?new Date(Math.max(y,x)):null):x)};l.dateSelected=function(x){x.preventDefault();var z=$(this);if(z.hasClass("inactive")||(z.text().length==0)){return}var y=new Date(p.getFullYear(),p.getMonth(),parseInt(z.text()));if(j){b(d,!c||(y.getTime()!=c.getTime())?y:null);return}if(!c){if(!r){b(d,y)}else{if(y<r){b(d,y)}else{if(r<y){b(d,r);b(g,y)}else{b(g,null)}}}}else{if(!r){if(c<y){b(g,y)}else{if(y<c){b(g,c);b(d,y)}else{b(d,null)}}}else{if(z.hasClass(d)){b(d,null)}else{if(z.hasClass(g)){b(g,null)}else{b(d,null);b(g,null)}}}}};l.extendDate=function(){Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.isLeapYear=function(){var x=this.getFullYear();return(((x%4===0)&&(x%100!==0))||(x%400===0))};Date.prototype.getDaysInMonth=function(){return[31,(this.isLeapYear(this.getFullYear())?29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype.moveToFirstDayOfMonth=function(){this.setDate(1);return this};Date.prototype.moveToLastDayOfMonth=function(){this.setDate(this.getDaysInMonth());return this};Date.prototype.addMilliseconds=function(x){this.setMilliseconds(this.getMilliseconds()+x);return this};Date.prototype.addDays=function(x){return this.addMilliseconds(x*86400000)};Date.prototype.addMonths=function(x){var y=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+x);this.setDate(Math.min(y,this.getDaysInMonth()));return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this}};l.getDay=function(x){return(x+m)%7};l.drawSelection=function(){i.removeClass(d).removeClass(g).removeClass("betweenDates");var z=p.clone().moveToFirstDayOfMonth();var B=p.clone().moveToLastDayOfMonth();var y=l.getDay(z.getDay())-1;if(!!c&&!!r&&(c<B)&&(r>z)){var x=new Date(Math.max(z,c.clone().addDays(1)));var A=new Date(Math.min(B,r.clone().addDays(-1)));if(x<=A){i.slice(y+x.getDate(),y+A.getDate()+1).addClass("betweenDates")}}if(!!c&&(z<=c)&&(c<=B)){i.eq(y+c.getDate()).addClass(d)}if(!!r&&(z<=r)&&(r<=B)){i.eq(y+r.getDate()).addClass(g)}};l.showMonth=function(y){e=new Date(Math.max(e,w));if(!!t){k.text(t.months.names["long"][y.getMonth()]+" "+y.getFullYear());for(var B=0,F=f.length;B<F;B++){f.eq(l.getDay(B)).text(t.days.names.min[B])}}var G=e>y.clone().moveToLastDayOfMonth();var C=!G&&(e>=y.clone().moveToFirstDayOfMonth());var A=e.getDate();i.addClass("noTransition").removeClass("inactive");o.removeClass("last").removeClass("hidden");for(var x=l.getDay(y.clone().moveToFirstDayOfMonth().getDay())-1,E=x+y.clone().moveToLastDayOfMonth().getDate(),B=0,F=i.length;B<F;B++){var D=(B>x)&&(B<=E);var z=i.eq(B).text(D?(""+(B-x)):"");if(D&&(G||(C&&(B-x<A)))){z.addClass("inactive")}if(C&&w.getDate()==(B-x)){z.addClass("today")}if(B==E){z.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}}setTimeout(function(){i.removeClass("noTransition")},0);l.drawSelection()}}})();