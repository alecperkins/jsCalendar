(function(d){function n(){var i=this,c,l,o,q,r,j,s,g,f,h,p,m,k,t,u=0,v=Modernizr.csstransforms3d?"webkit moz o ms khtml ".split(" ").join("AnimationEnd ")+"animationEnd":"noAnimationEnd",e=function(a,b){b&&b.clearTime&&b.clearTime();a=="startDate"?g=b:f=b;z();c.data(a.toLowerCase(),!b?"":b.toString());c.trigger(a+"Changed")},n=function(a){a.preventDefault();a=d(this);if(!(a.hasClass("inactive")||a.text().length==0)){var b=new Date(h.getFullYear(),h.getMonth(),parseInt(a.text()));t?e("startDate",!g||
b.getTime()!=g.getTime()?b:null):g?f?a.hasClass("startDate")?e("startDate",null):(a.hasClass("endDate")||e("startDate",null),e("endDate",null)):g<b?e("endDate",b):b<g?(e("endDate",g),e("startDate",b)):e("startDate",null):f?b<f?e("startDate",b):f<b?(e("startDate",f),e("endDate",b)):e("endDate",null):e("startDate",b)}},E=function(){Date.prototype.clone=function(){return new Date(this.getTime())};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return a%4===0&&a%100!==0||a%400===0};Date.prototype.getDaysInMonth=
function(){return[31,this.isLeapYear(this.getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype.moveToFirstDayOfMonth=function(){this.setDate(1);return this};Date.prototype.moveToLastDayOfMonth=function(){this.setDate(this.getDaysInMonth());return this};Date.prototype.addMilliseconds=function(a){this.setMilliseconds(this.getMilliseconds()+a);return this};Date.prototype.addDays=function(a){return this.addMilliseconds(a*864E5)};Date.prototype.addMonths=function(a){var b=
this.getDate();this.setDate(1);this.setMonth(this.getMonth()+a);this.setDate(Math.min(b,this.getDaysInMonth()));return this};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this}},w=function(a){return(a+u)%7},z=function(){j.removeClass("startDate").removeClass("endDate").removeClass("betweenDates");var a=h.clone().moveToFirstDayOfMonth(),b=h.clone().moveToLastDayOfMonth(),c=w(a.getDay())-1;if(g&&f&&g<b&&f>a){var d=new Date(Math.max(a,
g.clone().addDays(1))),e=new Date(Math.min(b,f.clone().addDays(-1)));d<=e&&j.slice(c+d.getDate(),c+e.getDate()+1).addClass("betweenDates")}g&&a<=g&&g<=b&&j.eq(c+g.getDate()).addClass("startDate");f&&a<=f&&f<=b&&j.eq(c+f.getDate()).addClass("endDate")};i.ready=function(a){c=a;l=d('<a href="#">&lt;</a>');o=d('<a href="#">&gt;</a>');q=d('<li class="calMonth"></li>');c.append(d('<ul class="calButtonBar"></ul>').append(d('<li class="calPrevious"></li>').append(l)).append(q).append(d('<li class="calNext"></li>').append(o)));
for(var a=0,b="",A="";a<7;a++)b+="<th></th>",A+='<td><a href="#"></a></td>';for(var a=0,B="";a<6;a++)B+="<tr>"+A+"</tr>";c.append('<div class="calGrid"><table><tr>'+b+"</tr>"+B+"</table></div>");r=c.find("th");j=c.find("td a");s=c.find("tr");s.eq(1).addClass("first");t=c.hasClass("jsSingleDate");u=c.data("firstdayofweek")||u;c.get(0).calendar=i;if(d.fn)d.fn.slice=d.fn.slice||function(a,b){return d([].slice.call(this,a,b))},d.fn.calendar=function(){return this.get(0).calendar};E();m=p=(new Date).clearTime();
g=(g=c.data("startdate"))?(new Date(g)).clearTime():null;f=(f=c.data("enddate"))?(new Date(f)).clearTime():null;h=(g||p).clone();k=c.data("localized_date");typeof k=="string"&&(k=JSON.parse(k));var x=c.find(".calGrid"),y=[],C=function(a){return x.children().length>1?(y.push(a),true):false},D=function(){y.length>0&&setTimeout(function(){y.shift().trigger("click")},0)};l.bind("click",function(a){a.preventDefault();if(!C(l)){h=h.addMonths(-1);var b=d("<table>"+c.find("table").html()+"</table>");x.append(b);
j.closest("table").addClass("turndown").bind(v,function(){d(this).removeClass("turndown").unbind(v);b.remove();D()}).trigger("noAnimationEnd");i.showMonth(h)}});o.bind("click",function(a){a.preventDefault();if(!C(o)){h=h.addMonths(1);var b=d('<table class="turnup">'+c.find("table").html()+"</table>");x.append(b);b.bind(v,function(){b.remove();D()}).trigger("noAnimationEnd");i.showMonth(h)}});c.bind("resetDates",function(){e("startDate",null);e("endDate",null)});j.bind("click",n);i.showMonth(h)};i.setDates=
function(a,b){e("startDate",a&&b?new Date(Math.min(a,b)):a);!t&&e("endDate",a&&b?a.getTime()!=b.getTime()?new Date(Math.max(a,b)):null:b)};i.showMonth=function(a){m=new Date(Math.max(m,p));if(k){q.text(k.months.names["long"][a.getMonth()]+" "+a.getFullYear());for(var b=0,c=r.length;b<c;b++)r.eq(w(b)).text(k.days.names.min[b])}var d=m>a.clone().moveToLastDayOfMonth(),e=!d&&m>=a.clone().moveToFirstDayOfMonth(),g=m.getDate();j.addClass("noTransition").removeClass("inactive");s.removeClass("last").removeClass("hidden");
for(var f=w(a.clone().moveToFirstDayOfMonth().getDay())-1,a=f+a.clone().moveToLastDayOfMonth().getDate(),b=0,c=j.length;b<c;b++){var h=b>f&&b<=a,i=j.eq(b).text(h?""+(b-f):"");h&&(d||e&&b-f<g)&&i.addClass("inactive");e&&p.getDate()==b-f&&i.addClass("today");b==a&&i.closest("tr").addClass("last").next().addClass("hidden").next().addClass("hidden")}setTimeout(function(){j.removeClass("noTransition")},0);z()}}d(document).ready(function(){if(!d.fn.Calendar.defer){for(var i=
d(".jsCalendar"),c=0,l=i.length;c<l;c++)(new n).ready(i.eq(c))}});d.fn.Calendar=function(){(new n).ready(this);return this};d.fn.Calendar.defer=false})(window.jQuery?jQuery:window.Zepto?Zepto:null);